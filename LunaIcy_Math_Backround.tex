\documentclass[A4,12pt,twoside]{book}
\usepackage{amd}

% %--------------------------------------------------------------------------
% %         General Setting
% %--------------------------------------------------------------------------

\graphicspath{{Images/}{../Images/}} %Path of figures
\setkeys{Gin}{width=0.85\textwidth} %Size of figures
\setlength{\cftbeforechapskip}{3pt} %space between items in toc
\setlength{\parindent}{0.5cm} % Idk
\input{theorems.tex} % Theorems styles and colors
\usepackage[english]{babel} %Language

\setlist[itemize]{itemsep=5pt} % Adjust the length as needed
\setlist[enumerate]{itemsep=5pt} % Adjust the length as needed


\usepackage[ruled,vlined]{algorithm2e}
% \usepackage{lmodern} %  Latin Modern font
% \usepackage{newtxtext,newtxmath}




% %--------------------------------------------------------------------------
% %         General Informations
% %--------------------------------------------------------------------------
\newcommand{\BigTitle}{
    A MATHEMATICAL TEMPLATE
    }

\newcommand{\LittleTitle}{
    For Mathematical Peoples
    }

    
\begin{document}








\chapter*{LunaIcy numerics of ODEs and PDEs}
\section{Mathematical Derivation of the Main Problem}
In light of the upcoming missions planned to Jupiters moon Europa such as JUICE and even mission that will attempt to drill through the ice sheet, the geometry of the ice grains are of great interest in order to succefully navigate such a mission! This little report explains the Paper ???. There it was proposed that the low thermal inertia of the porous ice can gives way for us to presume that the depth of significant tenperature changes before dissipating is very low (only a few centimeters). Thus in the following study of the ice sheets microstructure changes due to sintering can be limited to only a small gird. Further, at the bottom for the to be defined heat equation we can use Neumann boundary data that ensures that the temperature change has vanished, when reaching the bottom.\\
Consider a one dimensional slice of the Ice sheet of Jupiters moon Europa. This is our state space $\Omega := [0,d] \subset \mathbb{R}$ where $d$ denotes the depth od the ice sheet. This model attempts to model the changing ice grains and their bonds to their neighboring grains such that a steady state (fixed point of the dynamic system) is reached that aims to explain the ice grain and bond size in the ice sheet of Europa.
\begin{figure}[H]
  \centering
  \includegraphics[width=0.5\textwidth]{Pictures/Geometry.png}
  \caption{}
  \label{}
\end{figure}
In every state in $\Omega$ we denote the microstructure $y(x,t) := (r_g (x,t) , r_b (x,t))^T$, where $r_g$ is the grain radius and $r_b$ is the bond radius is modelled by the system of ODEs for every $x \in \Omega$ as 
\begin{equation}
\label{ODE}
\frac{d}{dt} y(x,t) = f(y(x,t), T(x,t)), t>0,\quad y(x,0) = y_0 (x).
\end{equation}
This change of radii is modeled indirectly via the water vapor transport. Consider the conservation law 
\[
\frac{d}{dt} (m_g (t) + m_b (t) + m_{gas}(t))=0
\]
where $m_g$ is the mass of the grain, $m_b$ mass of the bonds between two grains (we assume two bonds for each grain) and $m_{gas}$ the mass of the surrounding gas vapor mass in the pores. I.e. we have a closed system where we do not loose mass. A benifit of this approach is that we do not make assumptions on the underlying intial water vapor pressure, but only on its initial mass. Using the the Hertz-Knudsen formula transport only occurs proportionally to the difference in gas pressure in the pore space and the saturated water vapor pressure over a flat surface we get the ODE
\[
\frac{d}{dt} m_{gas} (t) = J_{v,g}(t) S_{v,g}(t) + J_{v,b} (t) S_{v,b}(t)
\]
which is an asymptotic stable linear ODE. Here $S_{v,g} (t)$ denotes the area of the grain with the outward gas and $J_{v,g}$ is the repective flux, $ S_{v,b}(t)$ the area of the bond with the gas, $S_{g,b}$ and $S_{b,g}$ the area of the grain with the bond. Only if these fluxes are non zero sublimation will occur!\\
We assume that this global fixed point is reached instantanuously, i.e. we assume $J_{v,g}(t) S_{v,g}(t) + J_{v,b} (t) S_{v,b}(t)=0= \frac{d}{dt} m_{gas}(t)$. Then grain/bond gains/losses of mass is described according to 
\[
\frac{d}{dt} m_{i} (t) = - J_{v,i}(t) S_{v,i}(t), \quad i=g,b.
\] 
After having updated the masses of the grain and the bonds we update their volumes 
\[
V_g (t+ \tau ) = \frac{m_g(t+ \tau)}{\rho_0}, \quad V_b (t+ \tau) = \frac{m_b(t+ \tau)}{\rho_0} ,
\]
and then retrive their respective radii via 
\[
\begin{pmatrix}
    r_g (t+\tau) \\ 
    r_b (t+\tau)
\end{pmatrix} = f(r_g,r_b):= \arg \min_{r_g,r_b} \begin{pmatrix}
    |V_g (t+ \tau) - v_g (r_g,r_b)| \\ 
    |V_b (t+ \tau) - v_b (r_g,r_b)|
\end{pmatrix} 
\]
This is the dynamics for each microstructure in a specific state $x \in \Omega$. This is now coupled with a heat equation on the same state space. The average temperature at $x \in \Omega$ is modelled via the heat eqaution with Neuman boundary data
\begin{align}
    \label{PDE}
&\rho (x,t) c_p (x,t) \frac{\partial}{\partial t} T(x,t) = \frac{\partial}{\partial x} k(x,t) \frac{\partial}{\partial x} T(x,t), \quad x \in \Omega, t>0 \\
\label{Neumann}
&k(0,t) \frac{\partial}{\partial x}  T(0,t) = - F_{solar} (t) + \epsilon \sigma_{SB} T(0,t)^4 \text{ and } k(d,t) \frac{\partial}{\partial x}  T(d,t) =0 , \quad t >0 \\
&T(x,0) = T_0 (x), x \in \Omega,
\end{align}
where $\rho,c_p$ and $k$ are model specific functions that depend on $y(x,t)$, coupling the ODE to the PDE. $F_{solar}$ is the energy that comes from the sun and $\sigma_{SB}$ and $\epsilon$ are model specific constants.\\
Thus, in order to model the changing microstructure that depends on the temperature, in each step we first solve for the equilibrium gas mass $m_{gas}(t)$, then update the masses for the grain and the bond by solving the ODE in each state, recover the new radii and fianlly solve the heat equation via the method of lines.


\section{Physics behind the model}
\subsection{Physics behind the ODE}
We denote by $P_{gas} (t) $ the pressure of the surrounding gas/water vapor at time $t$. $P_{K_j} (t)$ denotes the the equilibrium vapor pressure of a curved surface $j$ with average curvature $K_j$. Note that a result in ??? is that 
\[
\text{convex surface pressure $>$ flat surface pressure $>$ concave surface pressure.}
\]
The Flux of a grain or a bond is then given by 
\[
J_i (t) := \alpha (P_{K_i} (t) - P_{gas} (t)) \sqrt{\frac{M}{2 \pi R T(x,t)}}, \quad i = g,b,
\]
where $\alpha, R, M \in \mathbb{R}$ are constants and $T(x,t)$ denotes the temperature of the grain at point $x \in [0,d]$ at time $t\geq 0$. Here $\alpha$ is the sticking coefficient $R$ is the universal molar gas constant and $M$ the molar mass of water. The curved surface pressure of $K_j$ is given by 
\[
P_{K_j } (t) := P_{sat} (T(x,t)) \left( 1+ \frac{\gamma M}{R T(x,t) \rho_0} K_j (t) \right), \quad j=g,b,
\] 
where $\gamma,\rho_0 \in \mathbb{R}$ are constant, where $\gamma$ is the water surface tension and $\rho_0$ the bulk ice density. $P_{sat}(T(x,t))= P_0 e^{-\frac{Q_{sub}}{RT(x,t)}}$ is the saturated water pressure of a flat surface. Here $P_0,Q_{sub} \in \mathbb{R}$ are constants, where $P_0$ is called high temperature pressure limit, as theoreticall the temperature goes to infinity this saturated water pressure of a flat surface will be equal to $P_0 \cdot 1$. $Q_{sub}$ is the activation energy for sublimation.  Further, 
\[
P_{gas} (T(x,t)) := \frac{m_g (t) R T(x,t)}{M V_{pore}} =\frac{(1-\phi) m_{gas} (t) R T(x,t)}{M V_g \phi}, \quad  V_{pore} := V_g \frac{\phi}{1-\phi} ,
\]
where $V_g$ denotes the volume of the grain, $m_{gas}$ the equilibrium mass of water vapor mass and $\phi$ denotes the porosity.
\subsection{Physics behind the PDE}
The lower boundary data was described in the introduction. Here we will briefly describe the upper boundery data. Remember that 
\[
k(0,t) \frac{\partial}{\partial x}  T(0,t) = - F_{solar} (t) + \epsilon \sigma_{SB} T(0,t)^4. 
\]
The function $F_{solar}$ gives us the day and night cycle (eclipses by Jupiter and other moons is omitted) and the term $\epsilon \sigma_{SB} T(0,t)^4$ describes the thermal radiation from the surface into the vacuum, where $\epsilon$ denotes the emissivity of the ice surface, i.e. the efficiency at radiating thermal engery to a perfect black body. $\sigma_{SB}$ is the fundamental Stefan-Boltzmann constant. The first summand is defined in the $\lambda$ latitude and $\psi$ longitude as
\[
F_{solar } (t, \lambda, \psi) := (1- A(\lambda, \psi)) \frac{G_{sc}}{d(t)^2} \cos (\theta_i (t,\lambda,\psi)) \textbf{1}_{\{ \cos (\theta_i (t,\lambda,\psi))>0 \}},
\]
where $A$ is the surface albeto, $G_{sc}$ the solar constant and $\theta_i$ is the solar incidence angle abd $d(t)$ is the distance to the sun. Note that using this indicator function we can easily model the day and night cycle. \\ 
The other terms in the heat eqaution are described as follows. 
\[
\rho (\phi) = \rho_0 (1- \phi)
\]
is the density of porous ice, $c_p$ is the ice heat capacity constant. Note that the paper reasons that we can choose these two as constant, as it argues that the sintering process on Europa is primarly driven by evaporation and condensation, i.e. the pores void is assumed to stay constant and the thermal conductivity given by 
\[
k(\phi,r_b,r_g) = k_0 (T(x,t)) (1-\phi) \frac{r_b}{r_g}.
\]
This last term is here links the PDE to the ODE.

\section{Numerical Solution of the ODE}
\subsection{Deriving the ODE}
In the introduction we defined an ODE over the radii of the average grain and bond of the mircostructure. This paper models the change of mass of the grain and the bond using the interactions with the adjacent water vapor and then connect that to the change of the radii. We consider the ODE 
\[
\frac{d}{dt} \begin{pmatrix}
    m_g (t) \\ m_b (t)
\end{pmatrix} = \begin{pmatrix}
     J_{v,g} (t) S_{v,g} (t) +  J_{b,g} (t) S_{b,g} (t) \\
     J_{v,b} (t) S_{v,b}(t) + J_{g,b} (t) S_{g,b}(t)
\end{pmatrix}
\]
which stems from the Hertz-Knudsen formula. 





If we plug in the formulas into the ODE of gas mass change, which is instantanuously, i.e. $\frac{d}{dt} m_{gas}(t) =0$ we get a algebraically solvable equation
\begin{align*}
    &0=\frac{d}{dt} m_{gas} (t) = J_{v,g} (t) S_{v,g} (t)+ J_{v,b} (t) S_{v,b}(t) \\
    &= S_g \alpha \sqrt{\frac{M}{2 \pi R T(x,t)}} \left( P_s (T(x,t)) \left(1 + \frac{\gamma M}{R T(x,t) \rho_0} K_g  \right) -P_{gas}(T(x,t)) \right) \\
    &+ S_b \alpha \sqrt{\frac{M}{2 \pi R T(x,t)}} \left( P_s (T(x,t)) \left(1 + \frac{\gamma M}{R T(x,t) \rho_0} K_b \right)-P_{gas}(T(x,t))  \right) \\
    &= \alpha \sqrt{\frac{M}{2 \pi R T(x,t)}} \left( (s_g + S_b) P_s (T(x,t)) + S_g P_s (T(x,t)) \frac{\gamma M}{R T(x,t) \rho_0} K_g + S_b P_s (T(x,t)) \frac{\gamma M}{R T(x,t) \rho_0} K_b \right) \\
    &-\alpha \sqrt{\frac{M}{2 \pi R T(x,t)}}P_{gas}(T(x,t)) (S_g +S_b) \\
    &= P_s (T(x,t)) \alpha \sqrt{\frac{M}{2 \pi R T(x,t)}} \left(S_g +S_b +\frac{\gamma M}{R T(x,t) \rho_0} (S_g K_g+S_b K_b)  \right) -P_{gas}(T(x,t)) \alpha \sqrt{\frac{M}{2 \pi R T(x,t)}} (S_g +S_b)\\
    &= \alpha \sqrt{\frac{M}{2 \pi R T(x,t)}} \left(  P_0 e^{-\frac{Q_{sub}}{R T(x,t)}}  \left(S_g +S_b +\frac{\gamma M}{R T(x,t) \rho_0} (S_g K_g+S_b K_b)  \right) -\frac{(1-\phi) m_{gas} (t)  R T(x,t)}{M V_g \phi}  (S_g +S_b) \right).
\end{align*}
So we need to solve the above equation for $m_{gas}(t)$:
\[
m_{gas}(t) =  P_0 e^{-\frac{Q_{sub}}{R T(x,t)}}  \left(S_g +S_b +\frac{\gamma M}{R T(x,t) \rho_0} (S_g K_g+S_b K_b)  \right) \frac{M V_g \phi}{(1-\phi) R T(x,t) (S_g +S_b) }
\]






\subsection{Stiffness of the Problem}
Then grain/bond gains/losses of mass is described according to 
\[
\frac{d}{dt} m_{i} (t) = - J_{v,i}(t) S_{v,i}(t), \quad i=g,b.
\] 
Note that we need assume constant grain/bond geometry in a single time step of these two ODEs. This constrains the choice of the step size $\tau$ to be smaller than the time needed to significantly change the grains/bonds volumes $\tau_{sint_v}(r_b) := \min \{ t \geq 0 \mid |V_b (t)-V_b (0)|> \delta \}$.

\section{Numerical Solution of the PDE}
To numerically solve this PDE we first discretize the state space by $\Omega_h \subset \Omega$ and thus get a system of ODEs as (\ref{ODE}) and approximating (\ref{PDE}) by the methods of lines. We integrate both sides from $[x_{i-\frac{1}{2}}, x_{i+ \frac{1}{2}}]$ and divide by the length of the intervall $h$: 
\begin{align*}
&\rho (x,t) c_p (x,t) \frac{\partial}{\partial t} T(x,t) = \frac{\partial}{\partial x} k(x,t) \frac{\partial}{\partial x} T(x,t) \\
&\iff \frac{1}{h}\int_{x_{i-\frac{1}{2}}}^{x_{i+\frac{1}{2}}} \rho (x,t) c_p (x,t) \frac{\partial}{\partial t} T(x,t) dx = \frac{1}{h} \int_{x_{i-\frac{1}{2}}}^{x_{i+\frac{1}{2}}}\frac{\partial}{\partial x} k(x,t) \frac{\partial}{\partial x} T(x,t) dx \\
&\iff \frac{1}{h}\int_{x_{i-\frac{1}{2}}}^{x_{i+\frac{1}{2}}} \rho (x,t) c_p (x,t) \frac{\partial}{\partial t} T(x,t) dx = \frac{1}{h} \left( k(x_{i+\frac{1}{2}},t) \frac{\partial}{\partial x} T(x_{i+\frac{1}{2}},t) -  k(x_{i-\frac{1}{2}},t) \frac{\partial}{\partial x} T(x_{i-\frac{1}{2}},t) \right) \\
&\iff \frac{\partial}{\partial t} \frac{1}{h}\int_{x_{i-\frac{1}{2}}}^{x_{i+\frac{1}{2}}} \rho (x,t) c_p (x,t)  T(x,t) dx \\
&\qquad = \frac{1}{h} \left( k(x_{i+\frac{1}{2}},t) \frac{T(x_{i+1},t)-T(x_i,t)}{h} -  k(x_{i-\frac{1}{2}},t) \frac{T(x_i,t) - T(x_{i-1},t)}{h} + \mathcal{O}(h^2) \right).
\end{align*}
Thus for every $x_i$ we get the approximate ODE (second order error)
\[
\frac{\partial}{\partial t} \frac{1}{h}\int_{x_{i-\frac{1}{2}}}^{x_{i+\frac{1}{2}}} \rho (x,t) c_p (x,t)  T(x,t) dx \approx k(x_{i+\frac{1}{2}},t) \frac{T(x_{i+1},t)-T(x_i,t)}{h^2} -  k(x_{i-\frac{1}{2}},t) \frac{T(x_i,t) - T(x_{i-1},t)}{h^2} .
\]
We will approximate the left hand side integral by its center point (mean value theorem) and thus get the three point method 
\[
\frac{\partial}{\partial t} \frac{1}{h}  \rho (x_i,t) c_p (x_i,t)  T(x_i,t)  h \approx k(x_{i+\frac{1}{2}},t) \frac{T(x_{i+1},t)-T(x_i,t)}{h^2} -  k(x_{i-\frac{1}{2}},t) \frac{T(x_i,t) - T(x_{i-1},t)}{h^2} .
\]
This approximation only holds for the interior. Because we have Neumann boundary data (\ref{Neumann}) on both sides we need to introduce ghost cells. Aproximating the boundary data by symmetric differences, i.e. also second order, we get 
\begin{align*}
    &k(x_0,t) \frac{T( x_{1} ,t) -T(x_{-1},t)}{2h} + \mathcal{O}(h^2) = -F_{solar} (t) + \epsilon \sigma_{SB}
 T(x_0 , t)^4 \\
 & k(x_d,t) \frac{T(x_{d+1},t) - T(x_{d-1},t)}{2h} + \mathcal{O}(h^2) =0.
\end{align*}
Thus approximately it holds 
\begin{align*}
    &T(x_{-1},t) \approx   \frac{2h}{k(x_0,t)} \left(   F_{solar} (t)-\epsilon \sigma_{SB} T(x_0,t)^4  \right) +T(x_1,t) =: T_{-1} (t)  \\
    &T(x_{d+1},t) =  T(x_{d-1} ,t)
\end{align*}



Thus in total the following system of ODEs needs to be solved 
\begin{align*}
    \frac{d}{dt} \begin{pmatrix}
        y(x_0,t) \\
         \rho (x_0,t) c_p (x_0,t)  T(x_0,t) \\
        y(x_1,t) \\
         \rho (x_1,t) c_p (x_1,t)  T(x_1,t) \\
        \vdots \\
        y(x_{d-1},t) \\
          \rho (x_{d-1},t) c_p (x_{d-1},t)  T(x_{d-1},t) \\
        y(x_{d},t) \\
         \rho (x_d,t) c_p (x_d,t)  T(x_d,t) \\
    \end{pmatrix}
    = \begin{pmatrix}
        f(y(x_0,t),T(x_0,t))\\
        k(x_{\frac{1}{2}},t) \frac{T(x_{1},t)-T(x_0,t)}{h^2} -  k(x_{-\frac{1}{2}},t) \frac{T(x_0,t) - T_{-1} (t) }{h^2} \\
        f(y(x_1,t),T(x_1,t))\\
        k(x_{1+\frac{1}{2}},t) \frac{T(x_{2},t)-T(x_1,t)}{h^2} -  k(x_{1-\frac{1}{2}},t) \frac{T(x_1,t) - T(x_{0},t)}{h^2} \\
        \vdots \\
        f(y(x_{d-1},t),T(x_{d-1},t))\\
        k(x_{d-\frac{1}{2}},t) \frac{T(x_{d},t)-T(x_{d-1},t)}{h^2} -  k(x_{d-\frac{3}{2}},t) \frac{T(x_{d-1},t) - T(x_{d-2},t)}{h^2} \\
        f(y(x_{d},t),T(x_{d},t))\\
        k(x_{d+\frac{1}{2}},t) \frac{T(x_{d-1},t)-T(x_d,t)}{h^2} -  k(x_{d-\frac{1}{2}},t) \frac{T(x_d,t) - T(x_{d-1},t)}{h^2} \\
    \end{pmatrix}
\end{align*}
When considering the right hand side the product rule yields
\[
\frac{d}{dt} \rho (x_i,t) c_p (x_i,t)  T(x_i,t)  =  \rho (x_i,t) c_p (x_i,t) \frac{d}{dt} \left( T(x_i,t) \right)  + T(x_i,t) \frac{d}{dt} \left( \rho (x_i,t)  c_p (x_i,t)  \right).
\]
The second summand is neglegable due to the fact that it describes the rate at which the material properties change. One estimates the age of the Ice sheet to be 30 Million years old (R. T. Pappalardo et al. 1998). This begs the question wether Europaâ€™s ice microstructure
changed in a shorter time than its ice crust age? For simplifications, we answer this questions with no, for now. This simplies the system of ODEs to:
\[
 \frac{d}{dt} \begin{pmatrix}
        y(x_0,t) \\
          T(x_0,t) \\
        y(x_1,t) \\
          T(x_1,t) \\
        \vdots \\
        y(x_{d-1},t) \\
           T(x_{d-1},t) \\
        y(x_{d},t) \\
           T(x_d,t) \\
    \end{pmatrix}
    = \begin{pmatrix}
        f(y(x_0,t),T(x_0,t))\\
        \frac{1}{\rho (x_0,t) c_p (x_0,t)}\left( k(x_{\frac{1}{2}},t)  \frac{T(x_{1},t)-T(x_0,t)}{h^2} -  k(x_{-\frac{1}{2}},t) \frac{T(x_0,t) - T_{-1} (t) }{h^2} \right)\\
        f(y(x_1,t),T(x_1,t))\\
        \frac{1}{\rho (x_1,t) c_p (x_1,t) }\left( k(x_{1+\frac{1}{2}},t)  \frac{T(x_{2},t)-T(x_1,t)}{h^2} -  k(x_{1-\frac{1}{2}},t) \frac{T(x_1,t) - T(x_{0},t)}{h^2} \right)\\
        \vdots \\
        f(y(x_{d-1},t),T(x_{d-1},t))\\
        \frac{1}{\rho (x_{d-1},t) c_p (x_{d-1},t) }\left(k(x_{d-\frac{1}{2}},t)  \frac{T(x_{d},t)-T(x_{d-1},t)}{h^2} -  k(x_{d-\frac{3}{2}},t) \frac{T(x_{d-1},t) - T(x_{d-2},t)}{h^2} \right)\\
        f(y(x_{d},t),T(x_{d},t)) \\
        \frac{1}{\rho (x_d,t) c_p (x_d,t)} \left(k(x_{d+\frac{1}{2}},t) \frac{T(x_{d-1},t)-T(x_d,t)}{h^2} -  k(x_{d-\frac{1}{2}},t) \frac{T(x_d,t) - T(x_{d-1},t)}{h^2} \right)\\
    \end{pmatrix}
\]
\section{Geometry}
Here the volumes of the grains and bonds will be determined, as they are essential in the dynamics of the model.
\subsection{Grain Volume}
We begin by calulcating $1/4$ of the grains volume, where it is cut of at $\hat{x}^*$ at the $x_1 $ axis. This is the volume of the following set:
\[
V^{r_g} := \{ x \in \mathbb{R}^3 \mid |x| < r_g, 0 \leq x_1 < \hat{x}^*, 0 \leq x_2 \}.
\]
Further, for $u: \mathbb{R}^3 \to \mathbb{R}, x \mapsto \sqrt{x^2_1 +x^2_2 + x_3^2} = |x| $ the level set $u^{-1}$ describes the set of all points on the sphere $S_r^2$ with radius $r$. Cearly for all $x \in u^{-1} (r)$ the gradient is $\nabla u = \left( \frac{x_1}{r}, \frac{x_2}{r} , \frac{x_3}{r} \right)$ satisfies $|\nabla u|=1$. With the Co-area formula it holds 
\[
\int_{V^{r_g}} |\nabla u| d^3 x = \int_0^{r_g} \int_{ V^{r_g} \cap u^{-1}(r)} d \sigma (z) dr.
\]
Define the parametrization $\phi_r : U_r \to V^{r_g} \cap u^{-1} (r) , (\theta,\vartheta) \mapsto (r \sin (\vartheta) \cos (\theta),r \sin (\theta) \sin (\vartheta), r \cos (\vartheta))$, where \[
U_r := \{ (\theta, \vartheta) \in [0, \frac{\pi}{2}] \times [0,\pi] \mid  r \sin (\vartheta) \cos (\theta) < \hat{x}^* \}. 
\]
Its partial derivatives are 
\begin{align*}
&\frac{\partial}{\partial \theta} \phi_r (\theta, \vartheta) = (-r \sin (\vartheta ) \sin (\theta), r \cos (\theta) \sin (\vartheta),0) \\
& \frac{\partial}{\partial \vartheta} \phi_r (\theta, \vartheta) = (r \cos (\vartheta) \cos (\theta), r  \sin(\theta) \cos (\vartheta),-r \sin (\vartheta)).
\end{align*}
Then it holds that 
\[
\det \left(  \begin{pmatrix}
    (\frac{\partial}{\partial \theta} \phi_r)^T \frac{\partial}{\partial \theta} \phi_r & (\frac{\partial}{\partial \theta} \phi_r)^T \frac{\partial}{\partial \vartheta} \phi_r \\
    (\frac{\partial}{\partial \vartheta} \phi_r)^T \frac{\partial}{\partial \theta} \phi_r & (\frac{\partial}{\partial \vartheta} \phi_r)^T \frac{\partial}{\partial \vartheta} \phi_r
\end{pmatrix} \right) = \det \left( \begin{pmatrix}
    r^2 \sin (\vartheta)^2 &0 \\ 0 & r^2
\end{pmatrix} \right) = r^4 \sin (\vartheta)^2.
\]
Thus the manifold integral is given by 
\begin{align*}
&\int_0^{r_g} \int_{ V^{r_g} \cap u^{-1}(r)} d \sigma (z) dr = \int_0^{r_g} \int_{ U_r} 1 \circ \phi_r(\theta) \sqrt{\det((\phi^\prime) ^T \phi^\prime)} d(\theta,\vartheta) dr \\
&= \int_0^{r_g} \int_{ U_r}  1\cdot r^2 \sin (\vartheta) d (\theta,\vartheta) dr
\end{align*}
For $\hat{x}^* > r_g$ this integral is trivial equal to $\int_0^{r_g}\pi r^2 dr = \pi \frac{r_g^{3}}{3}$. More interesting in this application is the opposite case. In order to solve it, we use Fubini (where $U_r^\theta := \{ \vartheta \in [0,\pi] \mid (\theta,\vartheta) \in U_r \}$) 
\[
\int_0^{r_g} r^2 \int_0^{\pi/2} \int_{ U_r^\theta }   \sin (\vartheta) d \vartheta d\theta dr
\]
We now need to take a closer look at the inner most integral. The condition $\sin (\vartheta) < \frac{\hat{x}^*}{r \cos (\theta)}$ is satified if we choose $\theta = arcos (\frac{\hat{x}^*}{r})$ or larger, because 
\[
\sin (\vartheta) \leq 1 = \frac{\hat{x}^*}{r \cos arcos (\frac{\hat{x}^*}{r})} \text{ is always satisfied.}
\]
Thus for $\theta \geq arcos (\frac{\hat{x}^*}{r})$ we need no restriction. For $\theta < arcos (\frac{\hat{x}^*}{r})$ our condition is only satisfied, if
\[
\vartheta = \underbrace{arcsin (\frac{\hat{x}^*}{r \cos (\theta)})}_{=: B} 
\]
or smaller. It is also satified during this choice of $\theta  < arcos (\frac{\hat{x}^*}{r})$, if 
\[
 \pi - B < \vartheta \leq \pi, \text{ because } 0<\sin(\pi-arcsin (\frac{\hat{x}^*}{r \cos (\theta)}) )  < \frac{\hat{x}^*}{r \cos (arcos (\frac{\hat{x}^*}{r}))} =1
\]
and on that proposed intervall $\sin (\vartheta)$ is monotonically decreasing.??? Thus in total we get for $r < r_g$:
\begin{align*}
   &\int_0^{\pi/2} \int_{ U_r^\theta }   \sin (\vartheta) d \vartheta d \theta = \int_0^{arcos (\frac{\hat{x}^*}{r})} \left( \int^{ B}_0 \sin (\vartheta) d \vartheta +\int_{\pi-B}^\pi \sin (\vartheta) d \vartheta   \right) d \theta  + \int_{arcos(\frac{\hat{x}^*}{r})}^{\pi/2} \int_0^\pi   \sin(\vartheta) d \vartheta d \theta \\
   &= \int_0^{arcos (\frac{\hat{x}^*}{r})} \left( \cos (0) - \cos (B) + \cos (\pi -B)-\cos (\pi) \right) d \theta  + \int_{arcos(\frac{\hat{x}^*}{r})}^{\pi/2}    \cos(0)-\cos (\pi)   d \theta \\
   &= \int_0^{arcos (\frac{\hat{x}^*}{r})} \left( 1 - \cos (B) +\cos (\pi -B)+1 \right) d \theta  + \int_{arcos(\frac{\hat{x}^*}{r})}^{\pi/2}    2   d \theta \\
   &= \int_0^{arcos (\frac{\hat{x}^*}{r})} \left( 2 - \cos (B) -\cos (B) \right) d \theta  + 2 \left(  \frac{\pi}{2} - arcos(\frac{\hat{x}^*}{r})\right)\\
   &= 2arcos (\frac{\hat{x}^*}{r}) -2 \int_0^{arcos (\frac{\hat{x}^*}{r})} \cos (B)  d \theta  +  \pi- 2 arcos(\frac{\hat{x}^*}{r})\\
   &= \pi -2 \int_0^{arcos (\frac{\hat{x}^*}{r})} \cos (arcsin (\frac{\hat{x}^*}{r \cos (\theta)}))  d \theta  \\
   &= \pi -2 \int_0^{arcos (\frac{\hat{x}^*}{r})} \sqrt{1- \left( \frac{\hat{x}^*}{r \cos (\theta)} \right)^2}  d \theta 
\end{align*}
Thus in total it holds for $\hat{x}^* \leq r_g$ that
\begin{align*}
&\int_{V^{r_g}}  d^3 x= \int_0^{r_g} r^2 \text{1}_{0 \leq r < \hat{x}^*} \left( \pi - 2 \cdot 0\right)+ r^2 \left( \pi -2 \int_0^{arcos (\frac{\hat{x}^*}{r})} \sqrt{1- \left( \frac{\hat{x}^*}{r \cos (\theta)} \right)^2}  d \theta \right)  \text{1}_{ \hat{x}^*< r \leq r_g}  d r \\
&= \pi \frac{(\hat{x}^*)^3}{3}+\pi \left( \frac{r_g^3}{3} - \frac{(\hat{x}^*)^3}{3} \right) - 2\int^{r_g}_{\hat{x}^*} r^2 \underbrace{\int_0^{arcos (\frac{\hat{x}^*}{r})} \sqrt{1- \left( \frac{\hat{x}^*}{r \cos (\theta)} \right)^2}  d \theta}_{=: A(\hat{x}^*,r)} dr.
\end{align*}
Note that $A(\hat{x}^*,r)$ does not have an analytical solution and needs to be solved numerically. Note that we only calculated $1/4^{th}$ of its volume, i.e. we need to multiply the resulting value by $4$.
\subsection{Bond Volume}
The area of interest is 
\[
V^{r_b} := \{x \in \mathbb{R}^3 \mid 0 \leq x_1 \leq r_g -\hat{x}^*, \sqrt{x_2^2 + x_3^2} \leq r_b + r_p - \sqrt{r_p^2 -x_1^2}  \}
\]
Its Volume is easily given by 
\begin{align*}
&\int_{V^{r_p}} d^3 x = \int_0^{r_g - \hat{x}^*} \int_{\{ \sqrt{x_2^2+x_3^2 } \leq r(x_1) \}} d^2 (x_2,x_3) dx_1 = \int_0^{r_g - \hat{x}^*}  \pi r(x_1)^2 dx_1 \\
&= \int_0^{r_g - \hat{x}^*}  \pi (r_b + r_p)^2 dx_1  -2 (r_b + r_p)\underbrace{\pi \int_0^{r_g - \hat{x}^*}   \sqrt{r_p^2 -x_1^2}  dx_1}_{=:A} + \pi \int_0^{r_g - \hat{x}^*}  r_p^2 - \pi \int_0^{r_g - \hat{x}^*}  x^2 dx
\end{align*}
altough we denote $r(x_1) :=  r_b + r_p - \sqrt{r_p^2 -x_1^2} $. This is then 
\begin{align*}
A &= \pi \left[  \frac{x_1}{2} \sqrt{r_p^2 -x_1^2} + \frac{r_p^2}{2} arcsin\left( \frac{x_1}{r_p} \right) \right]_0^{r_g-\hat{x}^*} \\
&=  \pi \left(  \frac{r_g - \hat{x}^*}{2} \sqrt{r_p^2 -(r_g - \hat{x}^*)^2} + \frac{r_p^2}{2} arcsin\left( \frac{r_g - \hat{x}^*}{r_p} \right)\right) 
\end{align*}
Thus in total we have 
\begin{align*}
    \int_{V^{r_p}} d^3 x &= \pi (r_b + r_p)^2 (r_g - \hat{x}^*) - 2(r_b + r_p) \pi \left(  \frac{r_g - \hat{x}^*}{2} \sqrt{r_p^2 -(r_g - \hat{x}^*)^2} + \frac{r_p^2}{2} arcsin\left( \frac{r_g - \hat{x}^*}{r_p} \right)\right)  \\
    &+ \pi r_p^2 (r_g - \hat{x}^*) - \frac{\pi}{3} (r_g - \hat{x}^*)^3
\end{align*}
We can determine $r_p$ due to the fact that
\[
(r_g +r_p)^2 = r_g^2 + (r_b+r_p)^2 
\]
and solving it 
\[
r_p = \frac{r_b^2}{2(r_g - r_b)}.
\]




\subsection{Surface Area and Curvature}
The Surface area is in this model of crucial importance, as it models the exchange of water vapor mass. For the grain and the bond we can easily calculate it from our derivation above. The grains surface area is given by 
\[
S_g := r_g^2 \cdot \left( \pi -2 \int_0^{arcos (\frac{\hat{x}^*}{r_g})} \sqrt{1- \left( \frac{\hat{x}^*}{r_g \cos (\theta)} \right)^2}  d \theta  \right)
\]
and the surface area of the grain is given by the volume of the following set 
\[
S^{r_b} := \{ x \in \mathbb{R}^3 \mid 0 \leq x_1 \leq r_g -\hat{x}^*, \sqrt{x_2^2+x_3^2} = r(x_1) \}
\]
which is
\begin{align*}
   S_b:= \int_{S_b} d \sigma (z) = \int_0^{2 \pi} \int_0^{r_g -\hat{x}^*} \sqrt{\det ((D\Phi (x,\theta))^T D\Phi(x,\theta))} dx d \theta
\end{align*}
where $\Phi: [0,r_g -\hat{x}^*] \times [0,2\pi) \to \mathbb{R}^3, (x,\theta) \mapsto (x,r(x) \cos (\theta),r(x) \sin (\theta))$. Then we get the Jacobian 
\[
D \Phi = \begin{pmatrix}
    1 & 0 \\
    r^\prime (x) \cos (\theta) & - r(x) \sin (\theta)\\
    r^\prime (x) \sin (\theta) & r(x) \cos (\theta)
\end{pmatrix}.
\]
and thus 
\begin{align*}
S_b &= \int_0^{2 \pi} \int_0^{r_g -\hat{x}^*} r(x) \sqrt{1+ r^\prime (x)^2} dx d \theta \\
&= 2 \pi \int_0^{r_g -\hat{x}^*} r(x) \sqrt{1+ \frac{x^2}{r_p^2 -x^2 } } dx = 2 \pi r_p \left( (r_b + r_p) arcsin (\frac{r_g-\hat{x}^*}{r_p} ) - (r_g - \hat{x}^*) \right).
\end{align*}
The curvature of the grain is $K_g = \frac{2}{r_g}$ and of the bond $K_b = \frac{2}{r_b}$ repectively.




\section{Simulations}

\end{document}
